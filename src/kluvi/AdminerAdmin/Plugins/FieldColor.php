<?php

namespace kluvi\AdminerAdmin\Plugins;


class FieldColor extends AbstractAdminPlugin
{
    protected $libraryPrinted = false;

    function selectVal($val, $link, $field, $original)
    {
        $settings = $this->parseComment($field['comment']);
        if ($settings->type == 'color') {
            if(is_string($val) && $val[0] === '#') {
                return '<span style="background: '.$val.'; display: inline-block; width: 1em;height: 1em; border-radius: 0.5em;vertical-align: middle;margin-right: 5px"></span><span style="vertical-align: middle">'.$val.'</span>';
            }
            return $val;
        }
    }

    function editInput($table, $field, $attrs, $value)
    {
        $settings = $this->parseComment($field['comment']);
        if ($settings->type == 'color') {
            if(!$this->libraryPrinted) {
                echo '<script>' . base64_decode('LyohCiAqIGlyby5qcyB2NC41LjMKICogMjAxNi0yMDE5IEphbWVzIERhbmllbAogKiBMaWNlbnNlZCB1bmRlciBNUEwgMi4wCiAqIGdpdGh1Yi5jb20vamFhbWVzL2lyby5qcwogKi8KIWZ1bmN0aW9uKHQsZSl7Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzJiYidW5kZWZpbmVkIiE9dHlwZW9mIG1vZHVsZT9tb2R1bGUuZXhwb3J0cz1lKCk6ImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoZSk6dC5pcm89ZSgpfSh0aGlzLGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciBjPWZ1bmN0aW9uKCl7fSxpPXt9LGg9W10sdT1bXTtmdW5jdGlvbiBwKHQsZSl7dmFyIG8sbixyLGkscz1hcmd1bWVudHMsYT11O2ZvcihpPWFyZ3VtZW50cy5sZW5ndGg7MjxpLS07KWgucHVzaChzW2ldKTtmb3IoZSYmbnVsbCE9ZS5jaGlsZHJlbiYmKGgubGVuZ3RofHxoLnB1c2goZS5jaGlsZHJlbiksZGVsZXRlIGUuY2hpbGRyZW4pO2gubGVuZ3RoOylpZigobj1oLnBvcCgpKSYmdm9pZCAwIT09bi5wb3ApZm9yKGk9bi5sZW5ndGg7aS0tOyloLnB1c2gobltpXSk7ZWxzZSJib29sZWFuIj09dHlwZW9mIG4mJihuPW51bGwpLChyPSJmdW5jdGlvbiIhPXR5cGVvZiB0KSYmKG51bGw9PW4/bj0iIjoibnVtYmVyIj09dHlwZW9mIG4/bj1TdHJpbmcobik6InN0cmluZyIhPXR5cGVvZiBuJiYocj0hMSkpLHImJm8/YVthLmxlbmd0aC0xXSs9bjphPT09dT9hPVtuXTphLnB1c2gobiksbz1yO3ZhciBsPW5ldyBjO3JldHVybiBsLm5vZGVOYW1lPXQsbC5jaGlsZHJlbj1hLGwuYXR0cmlidXRlcz1udWxsPT1lP3ZvaWQgMDplLGwua2V5PW51bGw9PWU/dm9pZCAwOmUua2V5LGx9ZnVuY3Rpb24gTSh0LGUpe2Zvcih2YXIgbyBpbiBlKXRbb109ZVtvXTtyZXR1cm4gdH1mdW5jdGlvbiBsKHQsZSl7bnVsbCE9dCYmKCJmdW5jdGlvbiI9PXR5cGVvZiB0P3QoZSk6dC5jdXJyZW50PWUpfXZhciBlPSJmdW5jdGlvbiI9PXR5cGVvZiBQcm9taXNlP1Byb21pc2UucmVzb2x2ZSgpLnRoZW4uYmluZChQcm9taXNlLnJlc29sdmUoKSk6c2V0VGltZW91dCxmPS9hY2l0fGV4KD86c3xnfG58cHwkKXxycGh8b3dzfG1uY3xudHd8aW5lW2NoXXx6b298Xm9yZC9pLG89W107ZnVuY3Rpb24gcyh0KXshdC5fZGlydHkmJih0Ll9kaXJ0eT0hMCkmJjE9PW8ucHVzaCh0KSYmZShuKX1mdW5jdGlvbiBuKCl7Zm9yKHZhciB0O3Q9by5wb3AoKTspdC5fZGlydHkmJkkodCl9ZnVuY3Rpb24gUyh0LGUpe3JldHVybiB0Lm5vcm1hbGl6ZWROb2RlTmFtZT09PWV8fHQubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWUudG9Mb3dlckNhc2UoKX1mdW5jdGlvbiBFKHQpe3ZhciBlPU0oe30sdC5hdHRyaWJ1dGVzKTtlLmNoaWxkcmVuPXQuY2hpbGRyZW47dmFyIG89dC5ub2RlTmFtZS5kZWZhdWx0UHJvcHM7aWYodm9pZCAwIT09bylmb3IodmFyIG4gaW4gbyl2b2lkIDA9PT1lW25dJiYoZVtuXT1vW25dKTtyZXR1cm4gZX1mdW5jdGlvbiBOKHQpe3ZhciBlPXQucGFyZW50Tm9kZTtlJiZlLnJlbW92ZUNoaWxkKHQpfWZ1bmN0aW9uIHYodCxlLG8sbixyKXtpZigiY2xhc3NOYW1lIj09PWUmJihlPSJjbGFzcyIpLCJrZXkiPT09ZSk7ZWxzZSBpZigicmVmIj09PWUpbChvLG51bGwpLGwobix0KTtlbHNlIGlmKCJjbGFzcyIhPT1lfHxyKWlmKCJzdHlsZSI9PT1lKXtpZihuJiYic3RyaW5nIiE9dHlwZW9mIG4mJiJzdHJpbmciIT10eXBlb2Ygb3x8KHQuc3R5bGUuY3NzVGV4dD1ufHwiIiksbiYmIm9iamVjdCI9PXR5cGVvZiBuKXtpZigic3RyaW5nIiE9dHlwZW9mIG8pZm9yKHZhciBpIGluIG8paSBpbiBufHwodC5zdHlsZVtpXT0iIik7Zm9yKHZhciBpIGluIG4pdC5zdHlsZVtpXT0ibnVtYmVyIj09dHlwZW9mIG5baV0mJiExPT09Zi50ZXN0KGkpP25baV0rInB4IjpuW2ldfX1lbHNlIGlmKCJkYW5nZXJvdXNseVNldElubmVySFRNTCI9PT1lKW4mJih0LmlubmVySFRNTD1uLl9faHRtbHx8IiIpO2Vsc2UgaWYoIm8iPT1lWzBdJiYibiI9PWVbMV0pe3ZhciBzPWUhPT0oZT1lLnJlcGxhY2UoL0NhcHR1cmUkLywiIikpO2U9ZS50b0xvd2VyQ2FzZSgpLnN1YnN0cmluZygyKSxuP298fHQuYWRkRXZlbnRMaXN0ZW5lcihlLGQscyk6dC5yZW1vdmVFdmVudExpc3RlbmVyKGUsZCxzKSwodC5fbGlzdGVuZXJzfHwodC5fbGlzdGVuZXJzPXt9KSlbZV09bn1lbHNlIGlmKCJsaXN0IiE9PWUmJiJ0eXBlIiE9PWUmJiFyJiZlIGluIHQpe3RyeXt0W2VdPW51bGw9PW4/IiI6bn1jYXRjaCh0KXt9bnVsbCE9biYmITEhPT1ufHwic3BlbGxjaGVjayI9PWV8fHQucmVtb3ZlQXR0cmlidXRlKGUpfWVsc2V7dmFyIGE9ciYmZSE9PShlPWUucmVwbGFjZSgvXnhsaW5rOj8vLCIiKSk7bnVsbD09bnx8ITE9PT1uP2E/dC5yZW1vdmVBdHRyaWJ1dGVOUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsZS50b0xvd2VyQ2FzZSgpKTp0LnJlbW92ZUF0dHJpYnV0ZShlKToiZnVuY3Rpb24iIT10eXBlb2YgbiYmKGE/dC5zZXRBdHRyaWJ1dGVOUygiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsZS50b0xvd2VyQ2FzZSgpLG4pOnQuc2V0QXR0cmlidXRlKGUsbikpfWVsc2UgdC5jbGFzc05hbWU9bnx8IiJ9ZnVuY3Rpb24gZCh0KXtyZXR1cm4gdGhpcy5fbGlzdGVuZXJzW3QudHlwZV0odCl9dmFyIFQ9W10sSD0wLGc9ITEsXz0hMTtmdW5jdGlvbiBQKCl7Zm9yKHZhciB0O3Q9VC5zaGlmdCgpOyl0LmNvbXBvbmVudERpZE1vdW50JiZ0LmNvbXBvbmVudERpZE1vdW50KCl9ZnVuY3Rpb24gQSh0LGUsbyxuLHIsaSl7SCsrfHwoZz1udWxsIT1yJiZ2b2lkIDAhPT1yLm93bmVyU1ZHRWxlbWVudCxfPW51bGwhPXQmJiEoIl9fcHJlYWN0YXR0cl8iaW4gdCkpO3ZhciBzPVUodCxlLG8sbixpKTtyZXR1cm4gciYmcy5wYXJlbnROb2RlIT09ciYmci5hcHBlbmRDaGlsZChzKSwtLUh8fChfPSExLGl8fFAoKSksc31mdW5jdGlvbiBVKHQsZSxvLG4scil7dmFyIGk9dCxzPWc7aWYobnVsbCE9ZSYmImJvb2xlYW4iIT10eXBlb2YgZXx8KGU9IiIpLCJzdHJpbmciPT10eXBlb2YgZXx8Im51bWJlciI9PXR5cGVvZiBlKXJldHVybiB0JiZ2b2lkIDAhPT10LnNwbGl0VGV4dCYmdC5wYXJlbnROb2RlJiYoIXQuX2NvbXBvbmVudHx8cik/dC5ub2RlVmFsdWUhPWUmJih0Lm5vZGVWYWx1ZT1lKTooaT1kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShlKSx0JiYodC5wYXJlbnROb2RlJiZ0LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGksdCksTyh0LCEwKSkpLGkuX19wcmVhY3RhdHRyXz0hMCxpO3ZhciBhLGwsYz1lLm5vZGVOYW1lO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBjKXJldHVybiBmdW5jdGlvbih0LGUsbyxuKXt2YXIgcj10JiZ0Ll9jb21wb25lbnQsaT1yLHM9dCxhPXImJnQuX2NvbXBvbmVudENvbnN0cnVjdG9yPT09ZS5ub2RlTmFtZSxsPWEsYz1FKGUpO2Zvcig7ciYmIWwmJihyPXIuX3BhcmVudENvbXBvbmVudCk7KWw9ci5jb25zdHJ1Y3Rvcj09PWUubm9kZU5hbWU7ciYmbCYmKCFufHxyLl9jb21wb25lbnQpPyhqKHIsYywzLG8sbiksdD1yLmJhc2UpOihpJiYhYSYmKEwoaSksdD1zPW51bGwpLHI9UihlLm5vZGVOYW1lLGMsbyksdCYmIXIubmV4dEJhc2UmJihyLm5leHRCYXNlPXQscz1udWxsKSxqKHIsYywxLG8sbiksdD1yLmJhc2UscyYmdCE9PXMmJihzLl9jb21wb25lbnQ9bnVsbCxPKHMsITEpKSk7cmV0dXJuIHR9KHQsZSxvLG4pO2lmKGc9InN2ZyI9PT1jfHwiZm9yZWlnbk9iamVjdCIhPT1jJiZnLGM9U3RyaW5nKGMpLCghdHx8IVModCxjKSkmJihhPWMsKGw9Zz9kb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIixhKTpkb2N1bWVudC5jcmVhdGVFbGVtZW50KGEpKS5ub3JtYWxpemVkTm9kZU5hbWU9YSxpPWwsdCkpe2Zvcig7dC5maXJzdENoaWxkOylpLmFwcGVuZENoaWxkKHQuZmlyc3RDaGlsZCk7dC5wYXJlbnROb2RlJiZ0LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGksdCksTyh0LCEwKX12YXIgaD1pLmZpcnN0Q2hpbGQsdT1pLl9fcHJlYWN0YXR0cl8scD1lLmNoaWxkcmVuO2lmKG51bGw9PXUpe3U9aS5fX3ByZWFjdGF0dHJfPXt9O2Zvcih2YXIgZj1pLmF0dHJpYnV0ZXMsZD1mLmxlbmd0aDtkLS07KXVbZltkXS5uYW1lXT1mW2RdLnZhbHVlfXJldHVybiFfJiZwJiYxPT09cC5sZW5ndGgmJiJzdHJpbmciPT10eXBlb2YgcFswXSYmbnVsbCE9aCYmdm9pZCAwIT09aC5zcGxpdFRleHQmJm51bGw9PWgubmV4dFNpYmxpbmc/aC5ub2RlVmFsdWUhPXBbMF0mJihoLm5vZGVWYWx1ZT1wWzBdKToocCYmcC5sZW5ndGh8fG51bGwhPWgpJiZmdW5jdGlvbih0LGUsbyxuLHIpe3ZhciBpLHMsYSxsLGMsaD10LmNoaWxkTm9kZXMsdT1bXSxwPXt9LGY9MCxkPTAsdj1oLmxlbmd0aCxnPTAsXz1lP2UubGVuZ3RoOjA7aWYoMCE9PXYpZm9yKHZhciBtPTA7bTx2O20rKyl7dmFyIHk9aFttXSxiPXkuX19wcmVhY3RhdHRyXyx3PV8mJmI/eS5fY29tcG9uZW50P3kuX2NvbXBvbmVudC5fX2tleTpiLmtleTpudWxsO251bGwhPXc/KGYrKyxwW3ddPXkpOihifHwodm9pZCAwIT09eS5zcGxpdFRleHQ/IXJ8fHkubm9kZVZhbHVlLnRyaW0oKTpyKSkmJih1W2crK109eSl9aWYoMCE9PV8pZm9yKHZhciBtPTA7bTxfO20rKyl7bD1lW21dLGM9bnVsbDt2YXIgdz1sLmtleTtpZihudWxsIT13KWYmJnZvaWQgMCE9PXBbd10mJihjPXBbd10scFt3XT12b2lkIDAsZi0tKTtlbHNlIGlmKGQ8Zylmb3IoaT1kO2k8ZztpKyspaWYodm9pZCAwIT09dVtpXSYmKHg9cz11W2ldLEM9ciwic3RyaW5nIj09dHlwZW9mKGs9bCl8fCJudW1iZXIiPT10eXBlb2Ygaz92b2lkIDAhPT14LnNwbGl0VGV4dDoic3RyaW5nIj09dHlwZW9mIGsubm9kZU5hbWU/IXguX2NvbXBvbmVudENvbnN0cnVjdG9yJiZTKHgsay5ub2RlTmFtZSk6Q3x8eC5fY29tcG9uZW50Q29uc3RydWN0b3I9PT1rLm5vZGVOYW1lKSl7Yz1zLHVbaV09dm9pZCAwLGk9PT1nLTEmJmctLSxpPT09ZCYmZCsrO2JyZWFrfWM9VShjLGwsbyxuKSxhPWhbbV0sYyYmYyE9PXQmJmMhPT1hJiYobnVsbD09YT90LmFwcGVuZENoaWxkKGMpOmM9PT1hLm5leHRTaWJsaW5nP04oYSk6dC5pbnNlcnRCZWZvcmUoYyxhKSl9dmFyIHgsayxDO2lmKGYpZm9yKHZhciBtIGluIHApdm9pZCAwIT09cFttXSYmTyhwW21dLCExKTtmb3IoO2Q8PWc7KXZvaWQgMCE9PShjPXVbZy0tXSkmJk8oYywhMSl9KGkscCxvLG4sX3x8bnVsbCE9dS5kYW5nZXJvdXNseVNldElubmVySFRNTCksZnVuY3Rpb24odCxlLG8pe3ZhciBuO2ZvcihuIGluIG8pZSYmbnVsbCE9ZVtuXXx8bnVsbD09b1tuXXx8dih0LG4sb1tuXSxvW25dPXZvaWQgMCxnKTtmb3IobiBpbiBlKSJjaGlsZHJlbiI9PT1ufHwiaW5uZXJIVE1MIj09PW58fG4gaW4gbyYmZVtuXT09PSgidmFsdWUiPT09bnx8ImNoZWNrZWQiPT09bj90W25dOm9bbl0pfHx2KHQsbixvW25dLG9bbl09ZVtuXSxnKX0oaSxlLmF0dHJpYnV0ZXMsdSksZz1zLGl9ZnVuY3Rpb24gTyh0LGUpe3ZhciBvPXQuX2NvbXBvbmVudDtvP0wobyk6KG51bGwhPXQuX19wcmVhY3RhdHRyXyYmbCh0Ll9fcHJlYWN0YXR0cl8ucmVmLG51bGwpLCExIT09ZSYmbnVsbCE9dC5fX3ByZWFjdGF0dHJffHxOKHQpLHIodCkpfWZ1bmN0aW9uIHIodCl7Zm9yKHQ9dC5sYXN0Q2hpbGQ7dDspe3ZhciBlPXQucHJldmlvdXNTaWJsaW5nO08odCwhMCksdD1lfX12YXIgYT1bXTtmdW5jdGlvbiBSKHQsZSxvKXt2YXIgbixyPWEubGVuZ3RoO2Zvcih0LnByb3RvdHlwZSYmdC5wcm90b3R5cGUucmVuZGVyPyhuPW5ldyB0KGUsbykseS5jYWxsKG4sZSxvKSk6KChuPW5ldyB5KGUsbykpLmNvbnN0cnVjdG9yPXQsbi5yZW5kZXI9bSk7ci0tOylpZihhW3JdLmNvbnN0cnVjdG9yPT09dClyZXR1cm4gbi5uZXh0QmFzZT1hW3JdLm5leHRCYXNlLGEuc3BsaWNlKHIsMSksbjtyZXR1cm4gbn1mdW5jdGlvbiBtKHQsZSxvKXtyZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvcih0LG8pfWZ1bmN0aW9uIGoodCxlLG8sbixyKXt0Ll9kaXNhYmxlfHwodC5fZGlzYWJsZT0hMCx0Ll9fcmVmPWUucmVmLHQuX19rZXk9ZS5rZXksZGVsZXRlIGUucmVmLGRlbGV0ZSBlLmtleSx2b2lkIDA9PT10LmNvbnN0cnVjdG9yLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyYmKCF0LmJhc2V8fHI/dC5jb21wb25lbnRXaWxsTW91bnQmJnQuY29tcG9uZW50V2lsbE1vdW50KCk6dC5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzJiZ0LmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoZSxuKSksbiYmbiE9PXQuY29udGV4dCYmKHQucHJldkNvbnRleHR8fCh0LnByZXZDb250ZXh0PXQuY29udGV4dCksdC5jb250ZXh0PW4pLHQucHJldlByb3BzfHwodC5wcmV2UHJvcHM9dC5wcm9wcyksdC5wcm9wcz1lLHQuX2Rpc2FibGU9ITEsMCE9PW8mJigxIT09byYmITE9PT1pLnN5bmNDb21wb25lbnRVcGRhdGVzJiZ0LmJhc2U/cyh0KTpJKHQsMSxyKSksbCh0Ll9fcmVmLHQpKX1mdW5jdGlvbiBJKHQsZSxvLG4pe2lmKCF0Ll9kaXNhYmxlKXt2YXIgcixpLHMsYT10LnByb3BzLGw9dC5zdGF0ZSxjPXQuY29udGV4dCxoPXQucHJldlByb3BzfHxhLHU9dC5wcmV2U3RhdGV8fGwscD10LnByZXZDb250ZXh0fHxjLGY9dC5iYXNlLGQ9dC5uZXh0QmFzZSx2PWZ8fGQsZz10Ll9jb21wb25lbnQsXz0hMSxtPXA7aWYodC5jb25zdHJ1Y3Rvci5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMmJihsPU0oTSh7fSxsKSx0LmNvbnN0cnVjdG9yLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhhLGwpKSx0LnN0YXRlPWwpLGYmJih0LnByb3BzPWgsdC5zdGF0ZT11LHQuY29udGV4dD1wLDIhPT1lJiZ0LnNob3VsZENvbXBvbmVudFVwZGF0ZSYmITE9PT10LnNob3VsZENvbXBvbmVudFVwZGF0ZShhLGwsYyk/Xz0hMDp0LmNvbXBvbmVudFdpbGxVcGRhdGUmJnQuY29tcG9uZW50V2lsbFVwZGF0ZShhLGwsYyksdC5wcm9wcz1hLHQuc3RhdGU9bCx0LmNvbnRleHQ9YyksdC5wcmV2UHJvcHM9dC5wcmV2U3RhdGU9dC5wcmV2Q29udGV4dD10Lm5leHRCYXNlPW51bGwsdC5fZGlydHk9ITEsIV8pe3I9dC5yZW5kZXIoYSxsLGMpLHQuZ2V0Q2hpbGRDb250ZXh0JiYoYz1NKE0oe30sYyksdC5nZXRDaGlsZENvbnRleHQoKSkpLGYmJnQuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUmJihtPXQuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUoaCx1KSk7dmFyIHksYix3PXImJnIubm9kZU5hbWU7aWYoImZ1bmN0aW9uIj09dHlwZW9mIHcpe3ZhciB4PUUocik7KGk9ZykmJmkuY29uc3RydWN0b3I9PT13JiZ4LmtleT09aS5fX2tleT9qKGkseCwxLGMsITEpOih5PWksdC5fY29tcG9uZW50PWk9Uih3LHgsYyksaS5uZXh0QmFzZT1pLm5leHRCYXNlfHxkLGkuX3BhcmVudENvbXBvbmVudD10LGooaSx4LDAsYywhMSksSShpLDEsbywhMCkpLGI9aS5iYXNlfWVsc2Ugcz12LCh5PWcpJiYocz10Ll9jb21wb25lbnQ9bnVsbCksKHZ8fDE9PT1lKSYmKHMmJihzLl9jb21wb25lbnQ9bnVsbCksYj1BKHMscixjLG98fCFmLHYmJnYucGFyZW50Tm9kZSwhMCkpO2lmKHYmJmIhPT12JiZpIT09Zyl7dmFyIGs9di5wYXJlbnROb2RlO2smJmIhPT1rJiYoay5yZXBsYWNlQ2hpbGQoYix2KSx5fHwodi5fY29tcG9uZW50PW51bGwsTyh2LCExKSkpfWlmKHkmJkwoeSksKHQuYmFzZT1iKSYmIW4pe2Zvcih2YXIgQz10LFM9dDtTPVMuX3BhcmVudENvbXBvbmVudDspKEM9UykuYmFzZT1iO2IuX2NvbXBvbmVudD1DLGIuX2NvbXBvbmVudENvbnN0cnVjdG9yPUMuY29uc3RydWN0b3J9fWZvcighZnx8bz9ULnB1c2godCk6X3x8dC5jb21wb25lbnREaWRVcGRhdGUmJnQuY29tcG9uZW50RGlkVXBkYXRlKGgsdSxtKTt0Ll9yZW5kZXJDYWxsYmFja3MubGVuZ3RoOyl0Ll9yZW5kZXJDYWxsYmFja3MucG9wKCkuY2FsbCh0KTtIfHxufHxQKCl9fWZ1bmN0aW9uIEwodCl7dmFyIGU9dC5iYXNlO3QuX2Rpc2FibGU9ITAsdC5jb21wb25lbnRXaWxsVW5tb3VudCYmdC5jb21wb25lbnRXaWxsVW5tb3VudCgpLHQuYmFzZT1udWxsO3ZhciBvPXQuX2NvbXBvbmVudDtvP0wobyk6ZSYmKG51bGwhPWUuX19wcmVhY3RhdHRyXyYmbChlLl9fcHJlYWN0YXR0cl8ucmVmLG51bGwpLE4odC5uZXh0QmFzZT1lKSxhLnB1c2godCkscihlKSksbCh0Ll9fcmVmLG51bGwpfWZ1bmN0aW9uIHkodCxlKXt0aGlzLl9kaXJ0eT0hMCx0aGlzLmNvbnRleHQ9ZSx0aGlzLnByb3BzPXQsdGhpcy5zdGF0ZT10aGlzLnN0YXRlfHx7fSx0aGlzLl9yZW5kZXJDYWxsYmFja3M9W119ZnVuY3Rpb24gYih0LGUsbyxuKXt2b2lkIDA9PT1uJiYobj17fSk7Zm9yKHZhciByPTA7cjxlLmxlbmd0aDtyKyspdC5hZGRFdmVudExpc3RlbmVyKGVbcl0sbyxuKX1mdW5jdGlvbiB3KHQsZSxvLG4pe3ZvaWQgMD09PW4mJihuPXt9KTtmb3IodmFyIHI9MDtyPGUubGVuZ3RoO3IrKyl0LnJlbW92ZUV2ZW50TGlzdGVuZXIoZVtyXSxvLG4pfU0oeS5wcm90b3R5cGUse3NldFN0YXRlOmZ1bmN0aW9uKHQsZSl7dGhpcy5wcmV2U3RhdGV8fCh0aGlzLnByZXZTdGF0ZT10aGlzLnN0YXRlKSx0aGlzLnN0YXRlPU0oTSh7fSx0aGlzLnN0YXRlKSwiZnVuY3Rpb24iPT10eXBlb2YgdD90KHRoaXMuc3RhdGUsdGhpcy5wcm9wcyk6dCksZSYmdGhpcy5fcmVuZGVyQ2FsbGJhY2tzLnB1c2goZSkscyh0aGlzKX0sZm9yY2VVcGRhdGU6ZnVuY3Rpb24odCl7dCYmdGhpcy5fcmVuZGVyQ2FsbGJhY2tzLnB1c2godCksSSh0aGlzLDIpfSxyZW5kZXI6ZnVuY3Rpb24oKXt9fSk7dmFyIHg9Im1vdXNlZG93biIsaz0ibW91c2Vtb3ZlIixDPSJtb3VzZXVwIixCPSJ0b3VjaHN0YXJ0IixEPSJ0b3VjaG1vdmUiLFc9InRvdWNoZW5kIix0PWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQodCl7ZS5jYWxsKHRoaXMsdCksdGhpcy51aWQ9KE1hdGgucmFuZG9tKCkrMSkudG9TdHJpbmcoMzYpLnN1YnN0cmluZyg1KX1yZXR1cm4gZSYmKHQuX19wcm90b19fPWUpLCgodC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShlJiZlLnByb3RvdHlwZSkpLmNvbnN0cnVjdG9yPXQpLnByb3RvdHlwZS5jb21wb25lbnREaWRNb3VudD1mdW5jdGlvbigpe2IodGhpcy5iYXNlLFt4LEJdLHRoaXMse3Bhc3NpdmU6ITF9KX0sdC5wcm90b3R5cGUuY29tcG9uZW50V2lsbFVubW91bnQ9ZnVuY3Rpb24oKXt3KHRoaXMuYmFzZSxbeCxCXSx0aGlzKX0sdC5wcm90b3R5cGUuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24odCl7dC5wcmV2ZW50RGVmYXVsdCgpO3ZhciBlPXQudG91Y2hlcz90LmNoYW5nZWRUb3VjaGVzWzBdOnQsbz1lLmNsaWVudFgsbj1lLmNsaWVudFkscj10aGlzLmJhc2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7c3dpdGNoKHQudHlwZSl7Y2FzZSB4OmNhc2UgQjpiKGRvY3VtZW50LFtrLEQsQyxXXSx0aGlzLHtwYXNzaXZlOiExfSksdGhpcy5oYW5kbGVJbnB1dChvLG4sciwiU1RBUlQiKTticmVhaztjYXNlIGs6Y2FzZSBEOnRoaXMuaGFuZGxlSW5wdXQobyxuLHIsIk1PVkUiKTticmVhaztjYXNlIEM6Y2FzZSBXOnRoaXMuaGFuZGxlSW5wdXQobyxuLHIsIkVORCIpLHcoZG9jdW1lbnQsW2ssRCxDLFddLHRoaXMse3Bhc3NpdmU6ITF9KX19LHR9KHkpLFY9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJhc2UiKTtmdW5jdGlvbiBGKHQpe3ZhciBlPXdpbmRvdy5sb2NhdGlvbixvPXdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LG49L14oKD8hY2hyb21lfGFuZHJvaWQpLikqc2FmYXJpL2kudGVzdChvKSxyPS9pUGhvbmV8aVBvZHxpUGFkL2kudGVzdChvKTtyZXR1cm4obnx8cikmJjA8Vi5sZW5ndGg/ZS5wcm90b2NvbCsiLy8iK2UuaG9zdCtlLnBhdGhuYW1lK2Uuc2VhcmNoK3Q6dH1mdW5jdGlvbiAkKHQsZSxvLG4scil7dmFyIGk9ci1uPD0xODA/MDoxO3JldHVybiBuKj1NYXRoLlBJLzE4MCxyKj1NYXRoLlBJLzE4MCwiTSAiKyh0K28qTWF0aC5jb3MocikpKyIgIisoZStvKk1hdGguc2luKHIpKSsiIEEgIitvKyIgIitvKyIgMCAiK2krIiAwICIrKHQrbypNYXRoLmNvcyhuKSkrIiAiKyhlK28qTWF0aC5zaW4obikpfWZ1bmN0aW9uIEcodCl7dmFyIGU9dC5yLG89dC51cmw7cmV0dXJuIHAoInN2ZyIse2NsYXNzOiJpcm9fX2hhbmRsZSIseDp0LngseTp0Lnksc3R5bGU6e292ZXJmbG93OiJ2aXNpYmxlIn19LG8mJnAoInVzZSIsT2JqZWN0LmFzc2lnbih7fSx7eGxpbmtIcmVmOkYobyl9LHQub3JpZ2luKSksIW8mJnAoImNpcmNsZSIse2NsYXNzOiJpcm9fX2hhbmRsZV9faW5uZXIiLHI6ZSxmaWxsOiJub25lIiwic3Ryb2tlLXdpZHRoIjoyLHN0cm9rZToiIzAwMCJ9KSwhbyYmcCgiY2lyY2xlIix7Y2xhc3M6Imlyb19faGFuZGxlX19vdXRlciIscjplLTIsZmlsbDoibm9uZSIsInN0cm9rZS13aWR0aCI6MixzdHJva2U6IiNmZmYifSkpfUcuZGVmYXVsdFByb3BzPXt4OjAseTowLHI6OCx1cmw6bnVsbCxvcmlnaW46e3g6MCx5OjB9fTt2YXIgej1BcnJheS5hcHBseShudWxsLHtsZW5ndGg6MzYwfSkubWFwKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIGV9KSxxPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXt0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gdCYmKGUuX19wcm90b19fPXQpLCgoZS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZSh0JiZ0LnByb3RvdHlwZSkpLmNvbnN0cnVjdG9yPWUpLnByb3RvdHlwZS5fdHJhbnNmb3JtQW5nbGU9ZnVuY3Rpb24odCxlKXt2YXIgbz10aGlzLnByb3BzLndoZWVsQW5nbGU7cmV0dXJuKCh0PSJjbG9ja3dpc2UiPT09dGhpcy5wcm9wcy53aGVlbERpcmVjdGlvbj8tMzYwK3QtKGU/LW86byk6by10KSUzNjArMzYwKSUzNjB9LGUucHJvdG90eXBlLnJlbmRlcj1mdW5jdGlvbih0KXt2YXIgZT10aGlzLG89dC53aWR0aCxuPXQuYm9yZGVyV2lkdGgscj10LmhhbmRsZVJhZGl1cyxpPXQuY29sb3IuaHN2LHM9by8yLW4sYT10aGlzLl90cmFuc2Zvcm1BbmdsZShpLmgsITApKihNYXRoLlBJLzE4MCksbD1pLnMvMTAwKihzLXQucGFkZGluZy1yLW4pLGM9cytuLGg9cytuO3JldHVybiBwKCJzdmciLHtjbGFzczoiaXJvX193aGVlbCIsd2lkdGg6byxoZWlnaHQ6byxzdHlsZTp7b3ZlcmZsb3c6InZpc2libGUiLGRpc3BsYXk6ImJsb2NrIn19LHAoImRlZnMiLG51bGwscCgicmFkaWFsR3JhZGllbnQiLHtpZDp0aGlzLnVpZH0scCgic3RvcCIse29mZnNldDoiMCUiLCJzdG9wLWNvbG9yIjoiI2ZmZiJ9KSxwKCJzdG9wIix7b2Zmc2V0OiIxMDAlIiwic3RvcC1jb2xvciI6IiNmZmYiLCJzdG9wLW9wYWNpdHkiOiIwIn0pKSkscCgiZyIse2NsYXNzOiJpcm9fX3doZWVsX19odWUiLCJzdHJva2Utd2lkdGgiOnMsZmlsbDoibm9uZSJ9LHoubWFwKGZ1bmN0aW9uKHQpe3JldHVybiBwKCJwYXRoIix7a2V5OnQsZDokKGMsaCxzLzIsdCx0KzEuNSksc3Ryb2tlOiJoc2woIitlLl90cmFuc2Zvcm1BbmdsZSh0KSsiLCAxMDAlLCA1MCUpIn0pfSkpLHAoImNpcmNsZSIse2NsYXNzOiJpcm9fX3doZWVsX19zYXR1cmF0aW9uIixjeDpjLGN5OmgscjpzLGZpbGw6InVybCgiK0YoIiMiK3RoaXMudWlkKSsiKSJ9KSx0LndoZWVsTGlnaHRuZXNzJiZwKCJjaXJjbGUiLHtjbGFzczoiaXJvX193aGVlbF9fbGlnaHRuZXNzIixjeDpjLGN5OmgscjpzLGZpbGw6IiMwMDAiLG9wYWNpdHk6MS1pLnYvMTAwfSkscCgiY2lyY2xlIix7Y2xhc3M6Imlyb19fd2hlZWxfX2JvcmRlciIsY3g6YyxjeTpoLHI6cyxmaWxsOiJub25lIixzdHJva2U6dC5ib3JkZXJDb2xvciwic3Ryb2tlLXdpZHRoIjpufSkscChHLHtyOnIsdXJsOnQuaGFuZGxlU3ZnLG9yaWdpbjp0LmhhbmRsZU9yaWdpbix4OmMrbCpNYXRoLmNvcyhhKSx5OmgrbCpNYXRoLnNpbihhKX0pKX0sZS5wcm90b3R5cGUuaGFuZGxlSW5wdXQ9ZnVuY3Rpb24odCxlLG8sbil7dmFyIHI9by5sZWZ0LGk9by50b3Ascz10aGlzLnByb3BzLGE9cy53aWR0aC8yLGw9YS1zLnBhZGRpbmctcy5oYW5kbGVSYWRpdXMtcy5ib3JkZXJXaWR0aDt0PWEtKHQtciksZT1hLShlLWkpO3ZhciBjPU1hdGguYXRhbjIoZSx0KSxoPXRoaXMuX3RyYW5zZm9ybUFuZ2xlKE1hdGgucm91bmQoYyooMTgwL01hdGguUEkpKSsxODApLHU9TWF0aC5taW4oTWF0aC5zcXJ0KHQqdCtlKmUpLGwpO3Mub25JbnB1dChuLHtoOmgsczpNYXRoLnJvdW5kKDEwMC9sKnUpfSl9LGV9KHQpO2Z1bmN0aW9uIFgodCxlKXt2YXIgbz0tMTx0LmluZGV4T2YoIiUiKSxuPXBhcnNlRmxvYXQodCk7cmV0dXJuIG8/ZS8xMDAqbjpufWZ1bmN0aW9uIFkodCl7cmV0dXJuIHBhcnNlSW50KHQsMTYpfWZ1bmN0aW9uIEoodCl7cmV0dXJuIHQudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIjAiKX12YXIgSz0iKD86Wy1cXCtdP1xcZCpcXC5cXGQrJT8pfCg/OlstXFwrXT9cXGQrJT8pIixRPSJbXFxzfFxcKF0rKCIrSysiKVssfFxcc10rKCIrSysiKVssfFxcc10rKCIrSysiKVxccypcXCk/IixaPSJbXFxzfFxcKF0rKCIrSysiKVssfFxcc10rKCIrSysiKVssfFxcc10rKCIrSysiKVssfFxcc10rKCIrSysiKVxccypcXCk/Iix0dD1uZXcgUmVnRXhwKCJyZ2IiK1EpLGV0PW5ldyBSZWdFeHAoInJnYmEiK1opLG90PW5ldyBSZWdFeHAoImhzbCIrUSksbnQ9bmV3IFJlZ0V4cCgiaHNsYSIrWikscnQ9Il4oPzojP3wweD8pIixpdD0iKFswLTlhLWZBLUZdezF9KSIsc3Q9IihbMC05YS1mQS1GXXsyfSkiLGF0PW5ldyBSZWdFeHAoIiIrcnQraXQraXQraXQrIiQiKSxsdD1uZXcgUmVnRXhwKCIiK3J0K2l0K2l0K2l0K2l0KyIkIiksY3Q9bmV3IFJlZ0V4cCgiIitydCtzdCtzdCtzdCsiJCIpLGh0PW5ldyBSZWdFeHAoIiIrcnQrc3Qrc3Qrc3Qrc3QrIiQiKSx1dD1mdW5jdGlvbih0KXt0aGlzLl9vbkNoYW5nZT0hMSx0aGlzLl92YWx1ZT17aDowLHM6MCx2OjAsYToxfSx0JiZ0aGlzLnNldCh0KX0scHQ9e2hzdjp7Y29uZmlndXJhYmxlOiEwfSxyZ2I6e2NvbmZpZ3VyYWJsZTohMH0saHNsOntjb25maWd1cmFibGU6ITB9LHJnYlN0cmluZzp7Y29uZmlndXJhYmxlOiEwfSxoZXhTdHJpbmc6e2NvbmZpZ3VyYWJsZTohMH0saHNsU3RyaW5nOntjb25maWd1cmFibGU6ITB9fTt1dC5wcm90b3R5cGUuc2V0PWZ1bmN0aW9uKHQpe3ZhciBlPSJzdHJpbmciPT10eXBlb2YgdCxvPSJvYmplY3QiPT10eXBlb2YgdDtpZihlJiYvXig/OiM/fDB4PylbMC05YS1mQS1GXXszLDh9JC8udGVzdCh0KSl0aGlzLmhleFN0cmluZz10O2Vsc2UgaWYoZSYmL15yZ2JhPy8udGVzdCh0KSl0aGlzLnJnYlN0cmluZz10O2Vsc2UgaWYoZSYmL15oc2xhPy8udGVzdCh0KSl0aGlzLmhzbFN0cmluZz10O2Vsc2UgaWYobyYmdCBpbnN0YW5jZW9mIHV0KXRoaXMuaHN2PXQuaHN2O2Vsc2UgaWYobyYmInIiaW4gdCYmImciaW4gdCYmImIiaW4gdCl0aGlzLnJnYj10O2Vsc2UgaWYobyYmImgiaW4gdCYmInMiaW4gdCYmInYiaW4gdCl0aGlzLmhzdj10O2Vsc2V7aWYoIShvJiYiaCJpbiB0JiYicyJpbiB0JiYibCJpbiB0KSl0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgY29sb3IgdmFsdWUiKTt0aGlzLmhzbD10fX0sdXQucHJvdG90eXBlLnNldENoYW5uZWw9ZnVuY3Rpb24odCxlLG8pe3ZhciBuO3RoaXNbdF09T2JqZWN0LmFzc2lnbih7fSx0aGlzW3RdLCgobj17fSlbZV09byxuKSl9LHV0LnByb3RvdHlwZS5jbG9uZT1mdW5jdGlvbigpe3JldHVybiBuZXcgdXQodGhpcyl9LHV0LmhzdlRvUmdiPWZ1bmN0aW9uKHQpe3ZhciBlPXQuaC82MCxvPXQucy8xMDAsbj10LnYvMTAwLHI9TWF0aC5mbG9vcihlKSxpPWUtcixzPW4qKDEtbyksYT1uKigxLWkqbyksbD1uKigxLSgxLWkpKm8pLGM9ciU2O3JldHVybntyOjI1NSpbbixhLHMscyxsLG5dW2NdLGc6MjU1KltsLG4sbixhLHMsc11bY10sYjoyNTUqW3MscyxsLG4sbixhXVtjXX19LHV0LnJnYlRvSHN2PWZ1bmN0aW9uKHQpe3ZhciBlLG89dC5yLzI1NSxuPXQuZy8yNTUscj10LmIvMjU1LGk9TWF0aC5tYXgobyxuLHIpLHM9TWF0aC5taW4obyxuLHIpLGE9aS1zLGw9aSxjPTA9PT1pPzA6YS9pO3N3aXRjaChpKXtjYXNlIHM6ZT0wO2JyZWFrO2Nhc2UgbzplPShuLXIpL2ErKG48cj82OjApO2JyZWFrO2Nhc2UgbjplPShyLW8pL2ErMjticmVhaztjYXNlIHI6ZT0oby1uKS9hKzR9cmV0dXJue2g6NjAqZSxzOjEwMCpjLHY6MTAwKmx9fSx1dC5oc3ZUb0hzbD1mdW5jdGlvbih0KXt2YXIgZT10LnMvMTAwLG89dC52LzEwMCxuPSgyLWUpKm8scj1uPD0xP246Mi1uLGk9cjwxZS05PzA6ZSpvL3I7cmV0dXJue2g6dC5oLHM6MTAwKmksbDo1MCpufX0sdXQuaHNsVG9Ic3Y9ZnVuY3Rpb24odCl7dmFyIGU9Mip0Lmwsbz10LnMqKGU8PTEwMD9lOjIwMC1lKS8xMDAsbj1lK288MWUtOT8wOjIqby8oZStvKTtyZXR1cm57aDp0LmgsczoxMDAqbix2OihlK28pLzJ9fSxwdC5oc3YuZ2V0PWZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fdmFsdWU7cmV0dXJue2g6dC5oLHM6dC5zLHY6dC52fX0scHQuaHN2LnNldD1mdW5jdGlvbih0KXt2YXIgZT10aGlzLl92YWx1ZTtpZih0PU9iamVjdC5hc3NpZ24oe30sZSx0KSx0aGlzLl9vbkNoYW5nZSl7dmFyIG89e307Zm9yKHZhciBuIGluIGUpb1tuXT10W25dIT1lW25dO3RoaXMuX3ZhbHVlPXQsKG8uaHx8by5zfHxvLnZ8fG8uYSkmJnRoaXMuX29uQ2hhbmdlKHRoaXMsbyl9ZWxzZSB0aGlzLl92YWx1ZT10fSxwdC5yZ2IuZ2V0PWZ1bmN0aW9uKCl7dmFyIHQ9dXQuaHN2VG9SZ2IodGhpcy5fdmFsdWUpLGU9dC5yLG89dC5nLG49dC5iO3JldHVybntyOk1hdGgucm91bmQoZSksZzpNYXRoLnJvdW5kKG8pLGI6TWF0aC5yb3VuZChuKX19LHB0LnJnYi5zZXQ9ZnVuY3Rpb24odCl7dGhpcy5oc3Y9T2JqZWN0LmFzc2lnbih7fSx1dC5yZ2JUb0hzdih0KSx7YTp2b2lkIDA9PT10LmE/MTp0LmF9KX0scHQuaHNsLmdldD1mdW5jdGlvbigpe3ZhciB0PXV0LmhzdlRvSHNsKHRoaXMuX3ZhbHVlKSxlPXQuaCxvPXQucyxuPXQubDtyZXR1cm57aDpNYXRoLnJvdW5kKGUpLHM6TWF0aC5yb3VuZChvKSxsOk1hdGgucm91bmQobil9fSxwdC5oc2wuc2V0PWZ1bmN0aW9uKHQpe3RoaXMuaHN2PU9iamVjdC5hc3NpZ24oe30sdXQuaHNsVG9Ic3YodCkse2E6dm9pZCAwPT09dC5hPzE6dC5hfSl9LHB0LnJnYlN0cmluZy5nZXQ9ZnVuY3Rpb24oKXt2YXIgdD10aGlzLnJnYjtyZXR1cm4icmdiKCIrdC5yKyIsICIrdC5nKyIsICIrdC5iKyIpIn0scHQucmdiU3RyaW5nLnNldD1mdW5jdGlvbih0KXt2YXIgZSxvLG4scixpPTE7aWYoKGU9dHQuZXhlYyh0KSk/KG89WChlWzFdLDI1NSksbj1YKGVbMl0sMjU1KSxyPVgoZVszXSwyNTUpKTooZT1ldC5leGVjKHQpKSYmKG89WChlWzFdLDI1NSksbj1YKGVbMl0sMjU1KSxyPVgoZVszXSwyNTUpLGk9WChlWzRdLDEpKSwhZSl0aHJvdyBuZXcgRXJyb3IoImludmFsaWQgcmdiIHN0cmluZyIpO3RoaXMucmdiPXtyOm8sZzpuLGI6cixhOml9fSxwdC5oZXhTdHJpbmcuZ2V0PWZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5yZ2I7cmV0dXJuIiMiK0oodC5yKStKKHQuZykrSih0LmIpfSxwdC5oZXhTdHJpbmcuc2V0PWZ1bmN0aW9uKHQpe3ZhciBlLG8sbixyLGk9MjU1O2lmKChlPWF0LmV4ZWModCkpPyhvPTE3KlkoZVsxXSksbj0xNypZKGVbMl0pLHI9MTcqWShlWzNdKSk6KGU9bHQuZXhlYyh0KSk/KG89MTcqWShlWzFdKSxuPTE3KlkoZVsyXSkscj0xNypZKGVbM10pLGk9MTcqWShlWzRdKSk6KGU9Y3QuZXhlYyh0KSk/KG89WShlWzFdKSxuPVkoZVsyXSkscj1ZKGVbM10pKTooZT1odC5leGVjKHQpKSYmKG89WShlWzFdKSxuPVkoZVsyXSkscj1ZKGVbM10pLGk9WShlWzRdKSksIWUpdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGhleCBzdHJpbmciKTt0aGlzLnJnYj17cjpvLGc6bixiOnIsYTppLzI1NX19LHB0LmhzbFN0cmluZy5nZXQ9ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmhzbDtyZXR1cm4iaHNsKCIrdC5oKyIsICIrdC5zKyIlLCAiK3QubCsiJSkifSxwdC5oc2xTdHJpbmcuc2V0PWZ1bmN0aW9uKHQpe3ZhciBlLG8sbixyLGk9MTtpZigoZT1vdC5leGVjKHQpKT8obz1YKGVbMV0sMzYwKSxuPVgoZVsyXSwxMDApLHI9WChlWzNdLDEwMCkpOihlPW50LmV4ZWModCkpJiYobz1YKGVbMV0sMzYwKSxuPVgoZVsyXSwxMDApLHI9WChlWzNdLDEwMCksaT1YKGVbNF0sMSkpLCFlKXRocm93IG5ldyBFcnJvcigiaW52YWxpZCBoc2wgc3RyaW5nIik7dGhpcy5oc2w9e2g6byxzOm4sbDpyLGE6aX19LE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHV0LnByb3RvdHlwZSxwdCk7dmFyIGZ0PWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIGUoKXt0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1yZXR1cm4gdCYmKGUuX19wcm90b19fPXQpLCgoZS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZSh0JiZ0LnByb3RvdHlwZSkpLmNvbnN0cnVjdG9yPWUpLnByb3RvdHlwZS5yZW5kZXJHcmFkaWVudD1mdW5jdGlvbih0KXt2YXIgZT10LmNvbG9yLmhzdixvPVtdO3N3aXRjaCh0LnNsaWRlclR5cGUpe2Nhc2UiaHVlIjpvPVt7b2Zmc2V0OiIwIixjb2xvcjoiI2YwMCJ9LHtvZmZzZXQ6IjE2LjY2NiIsY29sb3I6IiNmZjAifSx7b2Zmc2V0OiIzMy4zMzMiLGNvbG9yOiIjMGYwIn0se29mZnNldDoiNTAiLGNvbG9yOiIjMGZmIn0se29mZnNldDoiNjYuNjY2Iixjb2xvcjoiIzAwZiJ9LHtvZmZzZXQ6IjgzLjMzMyIsY29sb3I6IiNmMGYifSx7b2Zmc2V0OiIxMDAiLGNvbG9yOiIjZjAwIn1dO2JyZWFrO2Nhc2Uic2F0dXJhdGlvbiI6dmFyIG49dXQuaHN2VG9Ic2woe2g6ZS5oLHM6MCx2OmUudn0pLHI9dXQuaHN2VG9Ic2woe2g6ZS5oLHM6MTAwLHY6ZS52fSk7bz1be29mZnNldDoiMCIsY29sb3I6ImhzbCgiK24uaCsiLCAiK24ucysiJSwgIituLmwrIiUpIn0se29mZnNldDoiMTAwIixjb2xvcjoiaHNsKCIrci5oKyIsICIrci5zKyIlLCAiK3IubCsiJSkifV07YnJlYWs7Y2FzZSJ2YWx1ZSI6ZGVmYXVsdDp2YXIgaT11dC5oc3ZUb0hzbCh7aDplLmgsczplLnMsdjoxMDB9KTtvPVt7b2Zmc2V0OiIwIixjb2xvcjoiIzAwMCJ9LHtvZmZzZXQ6IjEwMCIsY29sb3I6ImhzbCgiK2kuaCsiLCAiK2kucysiJSwgIitpLmwrIiUpIn1dfXJldHVybiBwKCJsaW5lYXJHcmFkaWVudCIse2lkOnRoaXMudWlkfSxvLm1hcChmdW5jdGlvbih0KXtyZXR1cm4gcCgic3RvcCIse29mZnNldDp0Lm9mZnNldCsiJSIsInN0b3AtY29sb3IiOnQuY29sb3J9KX0pKX0sZS5wcm90b3R5cGUucmVuZGVyPWZ1bmN0aW9uKHQpe3ZhciBlPXQud2lkdGgsbz10LnNsaWRlckhlaWdodCxuPXQuYm9yZGVyV2lkdGgscj10LmhhbmRsZVJhZGl1cztvPW98fDIqdC5wYWRkaW5nKzIqcisyKm4sdGhpcy53aWR0aD1lO3ZhciBpLHM9KHRoaXMuaGVpZ2h0PW8pLzIsYT1lLTIqcyxsPXQuY29sb3IuaHN2O3N3aXRjaCh0LnNsaWRlclR5cGUpe2Nhc2UiaHVlIjppPWwuaC89My42O2JyZWFrO2Nhc2Uic2F0dXJhdGlvbiI6aT1sLnM7YnJlYWs7Y2FzZSJ2YWx1ZSI6ZGVmYXVsdDppPWwudn1yZXR1cm4gcCgic3ZnIix7Y2xhc3M6Imlyb19fc2xpZGVyIix3aWR0aDplLGhlaWdodDpvLHN0eWxlOnttYXJnaW5Ub3A6dC5zbGlkZXJNYXJnaW4sb3ZlcmZsb3c6InZpc2libGUiLGRpc3BsYXk6ImJsb2NrIn19LHAoImRlZnMiLG51bGwsdGhpcy5yZW5kZXJHcmFkaWVudCh0KSkscCgicmVjdCIse2NsYXNzOiJpcm9fX3NsaWRlcl9fdmFsdWUiLHJ4OnMscnk6cyx4Om4vMix5Om4vMix3aWR0aDplLW4saGVpZ2h0Om8tbiwic3Ryb2tlLXdpZHRoIjpuLHN0cm9rZTp0LmJvcmRlckNvbG9yLGZpbGw6InVybCgiK0YoIiMiK3RoaXMudWlkKSsiKSJ9KSxwKEcse3I6cix1cmw6dC5oYW5kbGVTdmcsb3JpZ2luOnQuaGFuZGxlT3JpZ2luLHg6cytpLzEwMCphLHk6by8yfSkpfSxlLnByb3RvdHlwZS5nZXRWYWx1ZUZyb21Qb2ludD1mdW5jdGlvbih0LGUsbyl7dmFyIG49by5sZWZ0LHI9dGhpcy53aWR0aC10aGlzLmhlaWdodDt0LT1uK3RoaXMuaGVpZ2h0LzI7dmFyIGk9TWF0aC5tYXgoTWF0aC5taW4odCxyKSwwKTtyZXR1cm4gTWF0aC5yb3VuZCgxMDAvcippKX0sZS5wcm90b3R5cGUuaGFuZGxlSW5wdXQ9ZnVuY3Rpb24odCxlLG8sbil7dmFyIHIsaSxzPXRoaXMuZ2V0VmFsdWVGcm9tUG9pbnQodCxlLG8pO3N3aXRjaCh0aGlzLnByb3BzLnNsaWRlclR5cGUpe2Nhc2UiaHVlIjppPSJoIixzKj0zLjY7YnJlYWs7Y2FzZSJzYXR1cmF0aW9uIjppPSJzIjticmVhaztjYXNlInZhbHVlIjpkZWZhdWx0Omk9InYifXRoaXMucHJvcHMub25JbnB1dChuLCgocj17fSlbaV09cyxyKSl9LGV9KHQpO3ZhciBkdD1mdW5jdGlvbihlKXtmdW5jdGlvbiBpKHQpe2UuY2FsbCh0aGlzLHQpLHRoaXMuZW1pdEhvb2soImluaXQ6YmVmb3JlIiksdGhpcy5fZXZlbnRzPXt9LHRoaXMuX2RlZmVycmVkRXZlbnRzPXt9LHRoaXMuX2NvbG9yVXBkYXRlQWN0aXZlPSExLHRoaXMuX2NvbG9yVXBkYXRlU3JjPW51bGwsdGhpcy5pZD10LmlkLHRoaXMuY29sb3I9bmV3IHV0KHQuY29sb3IpLHRoaXMuZGVmZXJyZWRFbWl0KCJjb2xvcjppbml0Iix0aGlzLmNvbG9yLHtoOiExLHM6ITEsdjohMSxhOiExfSksdGhpcy5jb2xvci5fb25DaGFuZ2U9dGhpcy51cGRhdGVDb2xvci5iaW5kKHRoaXMpLHRoaXMuc3RhdGU9T2JqZWN0LmFzc2lnbih7fSx0LHtjb2xvcjp0aGlzLmNvbG9yLHJlZjp2b2lkIDB9KSx0aGlzLmVtaXRIb29rKCJpbml0OnN0YXRlIiksdC5sYXlvdXQ/dGhpcy5sYXlvdXQ9dC5sYXlvdXQ6dGhpcy5sYXlvdXQ9W3tjb21wb25lbnQ6cSxvcHRpb25zOnt9fSx7Y29tcG9uZW50OmZ0LG9wdGlvbnM6e319XSx0aGlzLmVtaXRIb29rKCJpbml0OmFmdGVyIil9cmV0dXJuIGUmJihpLl9fcHJvdG9fXz1lKSwoKGkucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoZSYmZS5wcm90b3R5cGUpKS5jb25zdHJ1Y3Rvcj1pKS5wcm90b3R5cGUub249ZnVuY3Rpb24odCxlKXt2YXIgbz10aGlzLG49dGhpcy5fZXZlbnRzOyhBcnJheS5pc0FycmF5KHQpP3Q6W3RdKS5mb3JFYWNoKGZ1bmN0aW9uKHQpe28uZW1pdEhvb2soImV2ZW50Om9uIix0LGUpLChuW3RdfHwoblt0XT1bXSkpLnB1c2goZSksby5fZGVmZXJyZWRFdmVudHNbdF0mJihvLl9kZWZlcnJlZEV2ZW50c1t0XS5mb3JFYWNoKGZ1bmN0aW9uKHQpe2UuYXBwbHkobnVsbCx0KX0pLG8uX2RlZmVycmVkRXZlbnRzW3RdPVtdKX0pfSxpLnByb3RvdHlwZS5vZmY9ZnVuY3Rpb24odCxvKXt2YXIgbj10aGlzOyhBcnJheS5pc0FycmF5KHQpP3Q6W3RdKS5mb3JFYWNoKGZ1bmN0aW9uKHQpe3ZhciBlPW4uX2V2ZW50c1t0XTtuLmVtaXRIb29rKCJldmVudDpvZmYiLHQsbyksZSYmZS5zcGxpY2UoZS5pbmRleE9mKG8pLDEpfSl9LGkucHJvdG90eXBlLmVtaXQ9ZnVuY3Rpb24odCl7Zm9yKHZhciBlLG89W10sbj1hcmd1bWVudHMubGVuZ3RoLTE7MDxuLS07KW9bbl09YXJndW1lbnRzW24rMV07KGU9dGhpcykuZW1pdEhvb2suYXBwbHkoZSxbdF0uY29uY2F0KG8pKTtmb3IodmFyIHI9dGhpcy5fZXZlbnRzW3RdfHxbXSxpPTA7aTxyLmxlbmd0aDtpKyspcltpXS5hcHBseSh0aGlzLG8pfSxpLnByb3RvdHlwZS5kZWZlcnJlZEVtaXQ9ZnVuY3Rpb24odCl7Zm9yKHZhciBlLG89W10sbj1hcmd1bWVudHMubGVuZ3RoLTE7MDxuLS07KW9bbl09YXJndW1lbnRzW24rMV07dmFyIHI9dGhpcy5fZGVmZXJyZWRFdmVudHM7KGU9dGhpcykuZW1pdC5hcHBseShlLFt0XS5jb25jYXQobykpLChyW3RdfHwoclt0XT1bXSkpLnB1c2gobyl9LGkucHJvdG90eXBlLnJlc2l6ZT1mdW5jdGlvbih0KXt0aGlzLnNldFN0YXRlKHt3aWR0aDp0fSl9LGkucHJvdG90eXBlLnJlc2V0PWZ1bmN0aW9uKCl7dGhpcy5jb2xvci5zZXQodGhpcy5wcm9wcy5jb2xvcil9LGkuYWRkSG9vaz1mdW5jdGlvbih0LGUpe3ZhciBvPWkucGx1Z2luSG9va3M7KG9bdF18fChvW3RdPVtdKSkucHVzaChlKX0saS5wcm90b3R5cGUuZW1pdEhvb2s9ZnVuY3Rpb24odCl7Zm9yKHZhciBlPVtdLG89YXJndW1lbnRzLmxlbmd0aC0xOzA8by0tOyllW29dPWFyZ3VtZW50c1tvKzFdO2Zvcih2YXIgbj1pLnBsdWdpbkhvb2tzW3RdfHxbXSxyPTA7cjxuLmxlbmd0aDtyKyspbltyXS5hcHBseSh0aGlzLGUpfSxpLnByb3RvdHlwZS5vbk1vdW50PWZ1bmN0aW9uKHQpe3RoaXMuZWw9dCx0aGlzLmRlZmVycmVkRW1pdCgibW91bnQiLHRoaXMpfSxpLnByb3RvdHlwZS51cGRhdGVDb2xvcj1mdW5jdGlvbih0LGUpe3RoaXMuZW1pdEhvb2soImNvbG9yOmJlZm9yZVVwZGF0ZSIsdCxlKSx0aGlzLnNldFN0YXRlKHtjb2xvcjp0fSksdGhpcy5lbWl0SG9vaygiY29sb3I6YWZ0ZXJVcGRhdGUiLHQsZSksdGhpcy5fY29sb3JVcGRhdGVBY3RpdmV8fCh0aGlzLl9jb2xvclVwZGF0ZUFjdGl2ZT0hMCwiaW5wdXQiPT10aGlzLl9jb2xvclVwZGF0ZVNyYyYmdGhpcy5lbWl0KCJpbnB1dDpjaGFuZ2UiLHQsZSksdGhpcy5lbWl0KCJjb2xvcjpjaGFuZ2UiLHQsZSksdGhpcy5fY29sb3JVcGRhdGVBY3RpdmU9ITEpfSxpLnByb3RvdHlwZS5oYW5kbGVJbnB1dD1mdW5jdGlvbih0LGUpeyJTVEFSVCI9PT10JiZ0aGlzLmVtaXQoImlucHV0OnN0YXJ0Iix0aGlzLmNvbG9yKSwiTU9WRSI9PT10JiZ0aGlzLmVtaXQoImlucHV0Om1vdmUiLHRoaXMuY29sb3IpLHRoaXMuX2NvbG9yVXBkYXRlU3JjPSJpbnB1dCIsdGhpcy5jb2xvci5oc3Y9ZSwiRU5EIj09PXQmJnRoaXMuZW1pdCgiaW5wdXQ6ZW5kIix0aGlzLmNvbG9yKSx0aGlzLl9jb2xvclVwZGF0ZVNyYz1udWxsfSxpLnByb3RvdHlwZS5yZW5kZXI9ZnVuY3Rpb24odCxuKXt2YXIgcj10aGlzO3JldHVybiBwKCJkaXYiLHtjbGFzczoiaXJvX19jb2xvclBpY2tlciIsaWQ6dC5pZCxzdHlsZTp7ZGlzcGxheTpuLmRpc3BsYXksd2lkdGg6bi53aWR0aH19LHRoaXMubGF5b3V0Lm1hcChmdW5jdGlvbih0KXt2YXIgZT10LmNvbXBvbmVudCxvPXQub3B0aW9ucztyZXR1cm4gcChlLE9iamVjdC5hc3NpZ24oe30sbixvLHtvbklucHV0OmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHIuaGFuZGxlSW5wdXQodCxlKX0scGFyZW50OnJ9KSl9KSl9LGl9KHkpO2R0LnBsdWdpbkhvb2tzPXt9LGR0LmRlZmF1bHRQcm9wcz17d2lkdGg6MzAwLGhlaWdodDozMDAsaGFuZGxlUmFkaXVzOjgsaGFuZGxlU3ZnOm51bGwsaGFuZGxlT3JpZ2luOnt4OjAseTowfSxjb2xvcjoiI2ZmZiIsYm9yZGVyQ29sb3I6IiNmZmYiLGJvcmRlcldpZHRoOjAsZGlzcGxheToiYmxvY2siLGlkOm51bGwsd2hlZWxMaWdodG5lc3M6ITAsd2hlZWxBbmdsZTowLHdoZWVsRGlyZWN0aW9uOiJhbnRpY2xvY2t3aXNlIixzbGlkZXJIZWlnaHQ6bnVsbCxzbGlkZXJNYXJnaW46MTIscGFkZGluZzo2LGxheW91dDpudWxsfTt2YXIgdnQsZ3QsX3QsbXQseXQ9KChndD1mdW5jdGlvbihlLHQpe3ZhciBvLG4scixpPW51bGwscz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtyZXR1cm4gbz1wKHZ0LE9iamVjdC5hc3NpZ24oe30se3JlZjpmdW5jdGlvbih0KXtyZXR1cm4gaT10fX0sdCkpLEEobixvLHt9LCExLHMsITEpLHI9ZnVuY3Rpb24oKXt2YXIgdD1lIGluc3RhbmNlb2YgRWxlbWVudD9lOmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZSk7dC5hcHBlbmRDaGlsZChpLmJhc2UpLGkub25Nb3VudCh0KX0sImxvYWRpbmciIT09ZG9jdW1lbnQucmVhZHlTdGF0ZT9yKCk6Yihkb2N1bWVudCxbIkRPTUNvbnRlbnRMb2FkZWQiXSxyKSxpfSkucHJvdG90eXBlPSh2dD1kdCkucHJvdG90eXBlLE9iamVjdC5hc3NpZ24oZ3QsdnQpLGd0Ll9fY29tcG9uZW50PXZ0LGd0KTtyZXR1cm4gbXQ9W10sKF90PXtDb2xvcjp1dCxDb2xvclBpY2tlcjp5dCx1aTp7aDpwLENvbXBvbmVudDp0LEhhbmRsZTpHLFNsaWRlcjpmdCxXaGVlbDpxfSx1dGlsOntyZXNvbHZlVXJsOkYsY3JlYXRlQXJjUGF0aDokLHBhcnNlVW5pdDpYLHBhcnNlSGV4SW50OlksaW50VG9IZXg6Sn0sdmVyc2lvbjoiNC41LjMifSkudXNlPWZ1bmN0aW9uKHQsZSl7dm9pZCAwPT09ZSYmKGU9e30pLC0xPG10LmluZGV4T2YodCl8fCh0KF90LGUpLG10LnB1c2godCkpfSxfdC5pbnN0YWxsZWRQbHVnaW5zPW10LF90fSk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWlyby5taW4uanMubWFwCg==') . '</script>';
                $this->libraryPrinted = true;
            }

            $randomId = rand(1,1000);
echo '<script>
document.addEventListener("DOMContentLoaded", function(event) { 
    var colorWheel = iro.ColorPicker("#color_picker_'.$randomId.'", {
        color: "'.$value.'"
    });
    
    colorWheel.on("color:change", function(color, changes) {
        input = document.getElementById("color_'.$randomId.'");
        input.style.backgroundColor = color.hexString;
        input.value = color.hexString;
    })
});
</script>';

            return '<input name="fields[' . $field['field'] . ']" value="' . $value . '" id="color_'.$randomId.'" style="background: '.$value.'"/><br />'.
                '<div id="color_picker_'.$randomId.'" rel="#color_'.$randomId.'"></div>';
        }
    }
}